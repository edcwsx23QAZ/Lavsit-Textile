# Настройка пересылки писем из Gmail для автоматизации

## Рекомендуемый вариант: Отдельный Gmail аккаунт

### Преимущества:
- ✅ Простая настройка пересылки
- ✅ Изоляция автоматизации от основного аккаунта
- ✅ Легкое управление фильтрами
- ✅ Безопасность (основной аккаунт не используется)
- ✅ Можно настроить автоматическую пересылку только нужных писем

---

## Пошаговая инструкция

### Шаг 1: Создать новый Gmail аккаунт

1. Перейдите на [accounts.google.com/signup](https://accounts.google.com/signup)
2. Создайте новый аккаунт с понятным именем, например:
   - `lavsit-textile-automation@gmail.com`
   - `fabric-supplier-email@gmail.com`
   - `your-company-automation@gmail.com`
3. Завершите регистрацию

### Шаг 2: Настроить пересылку из основного Gmail

#### Вариант A: Автоматическая пересылка всех писем (проще)

1. Откройте [Gmail](https://mail.google.com)
2. Нажмите на **шестеренку** (⚙️) → **"Все настройки"**
3. Перейдите на вкладку **"Пересылка и POP/IMAP"**
4. В разделе **"Пересылка"** нажмите **"Добавить адрес пересылки"**
5. Введите адрес нового аккаунта (например, `lavsit-textile-automation@gmail.com`)
6. Gmail отправит письмо с подтверждением на новый аккаунт
7. Откройте новый аккаунт и подтвердите пересылку
8. Вернитесь в настройки основного аккаунта
9. Выберите **"Пересылать копию входящих писем на..."** → выберите новый аккаунт
10. Выберите действие для оригинальных писем:
    - **"Оставить копию в папке Входящие"** (рекомендуется)
    - Или **"Архивировать"** (если не нужны копии)
11. Нажмите **"Сохранить изменения"**

#### Вариант B: Пересылка только писем от поставщиков (рекомендуется)

1. Откройте [Gmail](https://mail.google.com)
2. Нажмите на **шестеренку** (⚙️) → **"Все настройки"**
3. Перейдите на вкладку **"Фильтры и заблокированные адреса"**
4. Нажмите **"Создать фильтр"**
5. В поле **"От"** введите email поставщика (например, `supplier@example.com`)
   - Или используйте **"Тема содержит"** для фильтрации по теме
   - Например: `Остатки`, `Наличие тканей`, `Excel файл`
6. Нажмите **"Создать фильтр"**
7. Отметьте **"Переслать на"** → выберите новый аккаунт
8. Опционально: отметьте **"Пропустить папку Входящие"** (чтобы не дублировать)
9. Нажмите **"Создать фильтр"**

**Повторите для каждого поставщика**, создав отдельный фильтр.

### Шаг 3: Настроить новый аккаунт для приложения

1. Войдите в новый Gmail аккаунт (`lavsit-textile-automation@gmail.com`)
2. Включите IMAP:
   - Настройки → **"Пересылка и POP/IMAP"**
   - Включите **"Включить IMAP"**
   - Сохраните изменения
3. Создайте App Password:
   - Перейдите в [настройки аккаунта Google](https://myaccount.google.com/)
   - **Безопасность** → **Двухэтапная аутентификация** (включите, если еще не включена)
   - **Пароли приложений** → выберите **"Почта"** → **"Другое устройство"**
   - Введите название: `Lavsit Textile App`
   - Скопируйте 16-значный пароль

### Шаг 4: Настроить в приложении Lavsit Textile

1. Откройте приложение → страница **"Поставщики"**
2. Найдите или создайте поставщика с типом **"email"**
3. Нажмите **"Настройки Email"**
4. Заполните форму:
   - Нажмите кнопку **"Gmail"** (быстрая настройка)
   - **Email адрес**: `lavsit-textile-automation@gmail.com`
   - **Пароль**: вставьте App Password (16 символов)
   - **Email отправителя** (опционально): оставьте пустым или укажите email поставщика для фильтрации
   - **Фильтр по теме** (опционально): например, `Остатки` или `Excel`
5. Нажмите **"Сохранить"**

### Шаг 5: Тестирование

1. Отправьте тестовое письмо с Excel вложением на основной Gmail
2. Письмо должно автоматически переслаться в новый аккаунт
3. В приложении нажмите **"Проверить Email"**
4. Система должна найти и обработать письмо

---

## Альтернативные варианты

### Вариант 1: Использовать существующий Gmail с фильтрами

Если не хотите создавать новый аккаунт:

1. Настройте фильтры в основном Gmail для автоматической пересылки
2. Используйте основной аккаунт в приложении
3. **Минус**: основной аккаунт будет использоваться для автоматизации

### Вариант 2: Пересылка на другой провайдер

Можно пересылать на:
- **Яндекс.Почта** (`imap.yandex.ru:993`)
- **Mail.ru** (`imap.mail.ru:993`)
- **Outlook** (`outlook.office365.com:993`)

Настройка пересылки аналогична, но используйте настройки соответствующего провайдера.

### Вариант 3: Использовать Gmail Labels + Forwarding

1. Создайте метку (Label) "Поставщики" в Gmail
2. Настройте фильтр для автоматической метки
3. Настройте пересылку писем с этой меткой
4. Это позволяет лучше организовать письма

---

## Рекомендуемая структура

```
Основной Gmail (ваш личный)
    ↓
    [Фильтры по поставщикам]
    ↓
Новый Gmail (lavsit-textile-automation@gmail.com)
    ↓
    [Приложение Lavsit Textile]
    ↓
    [Обработка Excel файлов]
```

---

## Преимущества этого подхода

1. **Безопасность**: основной аккаунт не используется для автоматизации
2. **Простота**: не нужно настраивать доступ к основному аккаунту
3. **Гибкость**: легко добавить/удалить поставщиков через фильтры
4. **Изоляция**: все автоматизированные письма в одном месте
5. **Управление**: легко отслеживать, какие письма обработаны

---

## Дополнительные настройки

### Автоматическая архивация обработанных писем

В новом аккаунте можно настроить:
1. Фильтр для писем с определенной темой (например, "Обработано")
2. Автоматически архивировать такие письма
3. Это поможет поддерживать чистоту почтового ящика

### Уведомления

Можно настроить уведомления в основном Gmail:
- Когда письмо переслано
- Когда письмо обработано приложением

---

## Устранение неполадок

### Письма не пересылаются

1. Проверьте, что пересылка включена в настройках
2. Убедитесь, что фильтр правильно настроен
3. Проверьте, что письма соответствуют критериям фильтра

### Письма дублируются

1. В настройках пересылки выберите "Архивировать" вместо "Оставить в папке Входящие"
2. Или настройте фильтр с "Пропустить папку Входящие"

### Приложение не находит письма

1. Проверьте, что письма действительно пересланы в новый аккаунт
2. Убедитесь, что письма непрочитаны (система ищет только непрочитанные)
3. Проверьте фильтры по отправителю и теме в настройках приложения

---

## Примеры фильтров Gmail

### Фильтр для конкретного поставщика:
```
От: supplier@example.com
→ Переслать на: lavsit-textile-automation@gmail.com
→ Пропустить папку Входящие
```

### Фильтр по теме:
```
Тема содержит: "Остатки тканей" ИЛИ "Excel файл"
→ Переслать на: lavsit-textile-automation@gmail.com
→ Пропустить папку Входящие
```

### Фильтр по нескольким условиям:
```
От: supplier1@example.com ИЛИ supplier2@example.com
Тема содержит: "Остатки"
→ Переслать на: lavsit-textile-automation@gmail.com
→ Применить метку: "Поставщики"
```

---

## Безопасность

1. **Используйте App Password** для нового аккаунта (не обычный пароль)
2. **Включите двухфакторную аутентификацию** на обоих аккаунтах
3. **Регулярно проверяйте** активность в новом аккаунте
4. **Не используйте** новый аккаунт для других целей
5. **Храните App Password** в безопасном месте

---

## Итоговая рекомендация

**Создайте отдельный Gmail аккаунт** специально для автоматизации и настройте пересылку из основного аккаунта. Это самый простой и безопасный вариант.

**Пример названия аккаунта:**
- `lavsit-textile-auto@gmail.com`
- `yourcompany-fabrics@gmail.com`
- `supplier-automation@gmail.com`



